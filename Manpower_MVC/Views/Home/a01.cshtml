@{
    ViewBag.Title = "員工資料";
    //ViewBag.Description = "Home Page";
}

<table id="Employee" class="table table-striped table-bordered dataTable cell-border" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th></th>
            <th>工號</th>
            <th>姓名</th>
            <th>電話</th>
            <th>手機</th>
            <th>連絡人</th>
            <th>緊急連絡電話</th>
            <th>建立日期</th>
        </tr>
    </thead>
</table>


@section pagesection{
    <script charset="utf-8">
        $(document).ready(function () {
            editor = new $.fn.dataTable.Editor({
                ajax: {
                    create: {
                        type: "POST",
                        url: "../api/employee/create",
                    },
                    edit: {
                        type: "PUT",
                        url: "../api/employee/Edit",
                    },
                    remove: {
                        type: "POST",
                        url: "../api/employee/remove",
                    }
                },
                table: "#Employee",
                idSrc: 'ID',
                fields: [{
                    label: "工號:",
                    name: "EmpID"
                }, {
                    label: "姓名:",
                    name: "EmpName"
                }, {
                    label: "電話:",
                    name: "Tel"
                }, {
                    label: "手機:",
                    name: "Phone"
                }, {
                    label: "連絡人:",
                    name: "ConPerson"
                }, {
                    label: "緊急連絡電話:",
                    name: "ConPersonTel"
                }, {
                    label: "建立日期:",
                    name: "CreateDate"
                }
                ],
                i18n: {
                    //    // https://editor.datatables.net/reference/option/i18n
                    create: {
                        button: "create",
                        title: "新增員工資料",
                        submit: "新增"
                    },
                    edit: {
                        button: "edit",
                        title: "修改員工資料",
                        submit: "更新"
                    },
                    remove: {
                        button: "delete",
                        title: "刪除員工資料",
                        submit: "刪除",
                        confirm: {
                            "_": "您確定要刪除 %d 筆資料?",
                            "1": "您確定要刪除 1 筆資料?"
                        }
                    }
                }
            });

            editor.on('open', function () {
                table.keys.disable();
            });

            editor.on('close', function () {
                table.keys.enable();
            });

            //editor.on('submitSuccess', function (e, json, data) {
            //    alert('Success~~!!');
            //});

            var table = $('#Employee').DataTable({
                language: {
                    url: "../Content/dataTables.Chinese.traditional.txt"
                },
                ajax: {
                    url: "../api/employee/get",
                    type: 'GET',
                },
                columnDefs:[
                    {
                        targets: 0,
                        checkboxes: {
                            //selectRow:true
                        }
                    }
                ],
                columns: [
                    { data: 'ID' },
                    { data: 'EmpID' },
                    { data: 'EmpName' },
                    { data: 'Tel' },
                    { data: 'Phone' },
                    { data: 'ConPerson' },
                    { data: 'ConPersonTel' },
                    { data: 'CreateDate' }
                ],
                order: [[1, 'asc']],
                keys: true,
                displayLength:10,
                dom: 'lfrtipB',
                buttons: [
                    { extend: "create", text: "新增（Ins）", editor: editor, key: { key: '\x2D', altkey: false } },
                    {
                        extend: "edit", text: "修改（Enter）", editor: editor, key: { key: '\x0D', altkey: false }, className: 'btn-warning',
                        //action: function (e, dt, node, config) {
                        //    if ($('table').find('td.focus').length == 0) {
                        //        $('table').DataTable().cell(':eq(0)').focus();
                        //    }
                        //    editor.edit(table.row({ selected: true }).index());
                        //}
                    },
                    {
                        extend: "remove", text: "刪除（Del）", editor: editor, key: { key: '\x2E', altkey: false }, className: 'btn-danger',
                        formMessage: function (editor, dt) {
                            var rowData = dt.row({ selected: true }).data();
                            return '您確定要刪除 ' + rowData.CustName + ' 的資料?';
                        },
                    },
                    //{ extend: "print", text: "列印（5）", editor: editor, key: { key: '5', altkey: false }, className: 'btn-info' },
                    {
                        extend: "print", text: "列印", className: 'btn-success', exportOptions: {
                            columns: [1, 2, 3, 4, 5, 6, 7, 8, 9],
                            rows: function (idx, data, node) {
                                return $('td input', node).is(':checked');
                            }
                        }
                    }
                ],
                fnDrawCallback: function () {
                    //$('table').DataTable().cell(':eq(0)').focus();
                    $(":checkbox").prop('checked', true)
                }
            });

            //// Table 鍵盤事件
            table
                .on('key', function (e, datatable, key, cell, originalEvent) {
                    if (key == 32) {
                        // 按下空白鍵
                        $(".focus", this).closest('tr').find('input:checkbox').click();
                    }
                })
                .on('key-focus', function (e, datatable, cell) {
                    table.rows('.selected').deselect();

                    table.row(cell.index().row).select();
                })
                //.on('key-blur', function (e, datatable, cell) {

                //})
        });





    </script>
}